/**
 * @version 1.0.5
 * @package Perfect Easy & Powerful Contact Form
 * @copyright © 2014 Perfect Web sp. z o.o., All rights reserved. http://www.perfect-web.co
 * @license Perfect Web License http://www.perfect-web.co/license
 * @author Piotr Moćko
 *
 * jQuery 1.8+
 */
var pwebBoxes=pwebBoxes||[],pwebcontact_l10n=pwebcontact_l10n||{};!function(t){pwebContact=function(t){this.init(t)},pwebContact.prototype=function(){return{constructor:pwebContact,defaults:{id:"",selector:"#pwebcontact",selectorClass:".pwebcontact",debug:!1,ajaxUrl:"",reloadToken:!1,bootstrap:2,openAuto:!1,openDelay:0,maxAutoOpen:0,closeAuto:!1,closeDelay:0,closeOther:!0,reset:1,redirectURL:"",redirectDelay:3,layout:"slidebox",position:"left",offsetPosition:"top",tooltips:3,msgPosition:"after",msgCloseDelay:10,togglerNameOpen:"",togglerNameClose:"",slideWidth:0,slideDuration:400,slideTransition:"swing",accordionDuration:500,accordionEaseIn:"easeInBack",accordionEaseOut:"easeOutBounce",modalBackdrop:!0,modalClose:!0,modalStyle:"default",modalEffect:"fade",modalEffectDuration:400,modalEaseIn:"easeInCubic",modalEaseOut:"easeOutCubic",cookieLifetime:30,cookiePath:"/",cookieDomain:"",onLoad:function(){},onOpen:function(){},onClose:function(){},onComplete:function(){},onError:function(){},uploadAcceptFileTypes:/(\.|\/)(gif|jpe?g|png|docx?|odt|txt|pdf|zip)$/i,uploadMaxSize:1048576,uploadFilesLimit:5,uploadAutoStart:!0,validatorRules:[],calendars:[],calendarFirstDay:0},status:0,hidden:!0,timer:!1,validator:!1,tooltip:!1,uploader:!1,uploadQueue:0,files:[],init:function(s){var i=this;return this.options=t.extend({},this.defaults,s),this.options.selector=this.options.selector+this.options.id,this.options.selectorClass=this.options.selectorClass+this.options.id,this.element=t(this.options.selector),this.Msg=t(this.options.selector+"_msg"),this.Form=t(this.options.selector+"_form"),this.ButtonSend=t(this.options.selector+"_send"),this.Toggler=t(this.options.selector+"_toggler"),this.Box=t(this.options.selector+"_box"),this.Container=t(this.options.selector+"_container"),this.Token=t(this.options.selector+"_token"),this.Form.get(0)&&this.Form.get(0).reset(),this.Form.submit(function(t){t.preventDefault()}),"slidebox"!=this.options.layout?!1:(this.element.appendTo(document.body),this.options.togglerSlide=this.Box.hasClass("pweb-toggler-slide"),this.options.togglerHidden=this.Box.hasClass("pweb-toggler-hidden"),this.options.slidePos=this.element.css("position"),this.options.slideWidth||(this.options.slideWidth=parseInt(this.Box.css("max-width"))),this.Box.css("width",this.options.slideWidth),"left"==this.options.position||"right"==this.options.position?(this.Box.css(this.options.position,-this.options.slideWidth),this.options.togglerWidth=this.options.togglerSlide?this.Toggler.outerWidth():0,this.options.togglerHeight=this.options.togglerSlide?parseInt(this.Box.css("top")):0,this.options.slideOffset=parseInt(this.element.css("top")),this.options.togglerSlide&&this.Toggler.css("left"==this.options.position?"right":"left",-this.Toggler.outerWidth())):(this.Box.css(this.options.position,-this.Box.height()),this.options.togglerWidth=0,this.options.togglerHeight=this.options.togglerSlide?this.Toggler.outerHeight():0,this.options.slideOffset=0,this.options.togglerSlide&&this.Toggler.css("top"==this.options.position?"bottom":"top",-this.Toggler.outerHeight())),this.Box.addClass("pweb-closed").removeClass("pweb-init"),this.options.togglerHidden&&(this.Toggler.fadeOut(0).removeClass("pweb-closed").addClass("pweb-opened"),this.options.togglerNameClose&&this.Toggler.find(".pweb-text").text(this.options.togglerNameClose)),this.isFF=-1!=navigator.userAgent.indexOf("Gecko"),t(window).scroll(function(){if(!i.hidden&&"absolute"==i.element.css("position")&&"fixed"==i.options.slidePos){var s=t(this).scrollTop();"bottom"==i.options.position?(s+=t(this).height(),s>i.element.offset().top&&(i.isFF?i.element.css("top",s):i.element.stop().animate({top:s},250,"linear"))):(s+=i.options.slideOffset,s<i.element.offset().top&&(i.isFF?i.element.css("top",s):i.element.stop().animate({top:s},250,"linear")))}}),"static"!=this.options.layout&&t(this.options.selectorClass+"_toggler").click(function(t){t.preventDefault(),i.toggleForm(-1,-1,this,t)}),this.initHiddenFields(),this.initValidator(),this.ButtonSend.click(function(){i.submitForm()}),this.displayMsg("",""),this)},initValidator:function(){var s=this;return"function"==typeof t.fn.validate?(t.each(this.options.validatorRules,function(i,o){t.validator.addMethod("pweb"+s.options.id+"-validate-"+o.name,function(t,s){return this.optional(s)||o.regexp.test(t)},"")}),this.validator=this.Form.validate({debug:this.options.debug,onsubmit:!1,errorClass:"invalid",showErrors:function(i,o){var e,n;for(e=0;o[e];e++){var l=o[e].element;if(this.settings.highlight.call(this,l,this.settings.errorClass,this.settings.validClass),l=t(l),l.hasClass("pweb-fieldset")&&(l=l.parents("fieldset")),t("#"+l[0].id+"-lbl").addClass(this.settings.errorClass),0==e&&"fixed"!=s.element.css("position")&&"fixed"!=s.element.css("position")){var a=l.parent().parent().offset().top-10,r=t(window).scrollTop(),d=t(window).height();(r+50>a||a>r+d-50)&&(a-=d/2,t("html,body").animate({scrollTop:parseInt(a)},500))}}for(e=0,n=this.validElements();n[e];e++){var l=n[e];this.settings.unhighlight.call(this,l,this.settings.errorClass,this.settings.validClass),l=t(l),l.hasClass("pweb-fieldset")&&(l=l.parents("fieldset")),t("#"+l[0].id+"-lbl").removeClass(this.settings.errorClass)}}}),!0):(this.options.debug&&this.debug("jQuery Validate Plugin is not loaded"),!1)},initHiddenFields:function(){return t("<input/>",{type:"hidden",name:"title",value:document.title}).appendTo(this.Form),t("<input/>",{type:"hidden",name:"url",value:document.location.href}).appendTo(this.Form),this.options.debug&&t("<input/>",{type:"hidden",name:"debug",value:1}).appendTo(this.Form),!0},close:function(){this.toggleForm(0)},toggleForm:function(s,i,o){var e=this;if("undefined"==typeof s&&(s=-1),"undefined"==typeof o&&(o=this.Toggler),this.hidden||-1!==s&&0!==s){if(this.hidden&&(-1===s||1===s)&&(this.hidden=!1,this.Toggler.length&&!this.options.togglerHidden&&(this.Toggler.removeClass("pweb-closed").addClass("pweb-opened"),this.options.togglerNameClose&&this.Toggler.find(".pweb-text").text(this.options.togglerNameClose)),"slidebox"==this.options.layout)){var n={width:this.options.slideWidth};n[this.options.position]=0;var l=t(window).width();if("left"==this.options.position||"right"==this.options.position)this.options.slideWidth+this.options.togglerWidth>l&&(n.width=l-this.options.togglerWidth);else{var a=this.element.offset().left;"right"==this.options.offsetPosition&&(a=t(document).width()-a),this.options.slideWidth+a>l&&(n.width=l-a)}this.Box.stop(!0,!1).animate(n,this.options.slideDuration,this.options.slideTransition,function(){if("fixed"==e.options.slidePos){var s={position:"absolute"};"left"==e.options.position||"right"==e.options.position?(s.top=e.element.offset().top,e.Box.height()+e.options.togglerHeight+s.top-t(window).scrollTop()>t(window).height()&&(s.top=e.element.offset().top,e.element.css(s))):e.Box.height()+e.options.togglerHeight>t(window).height()&&(s.top=e.element.offset().top,"bottom"==e.options.position&&(s.bottom="auto"),e.element.css(s))}}).css("overflow","visible").removeClass("pweb-closed"),this.options.togglerHidden&&this.Toggler.fadeIn(this.options.slideDuration)}}else if(this.hidden=!0,this.Toggler.length&&!this.options.togglerHidden&&(this.Toggler.removeClass("pweb-opened").addClass("pweb-closed"),this.options.togglerNameClose&&this.Toggler.find(".pweb-text").text(this.options.togglerNameOpen)),this.options.openAuto===!1&&this.timer&&clearTimeout(this.timer),"slidebox"==this.options.layout){var n={};n[this.options.position]="left"==this.options.position||"right"==this.options.position?-this.Box.width():-this.Box.height(),this.Box.stop(!0,!1).animate(n,this.options.slideDuration,this.options.slideTransition,function(){if("absolute"==e.element.css("position")&&"fixed"==e.options.slidePos){var t={position:"fixed"};"left"==e.options.position||"right"==e.options.position?t.top=e.options.slideOffset:(t[e.options.position]=0,"bottom"==e.options.position&&(t.top="auto")),e.element.css(t)}}).addClass("pweb-closed"),this.options.togglerHidden&&this.Toggler.fadeOut(this.options.slideDuration)}},resetForm:function(){if(3==this.status){var t=this;setTimeout(function(){t.status=0},5e3),this.status=4,this.displayMsg("",""),this.ButtonSend.show(),this.validator&&this.validator.resetForm(),this.Form.get(0)&&this.Form.get(0).reset()}},submitForm:function(){if(1==this.status||2==this.status||3==this.status||5==this.status)return!1;if(this.validator&&!this.validator.form())return!1;if(4==this.status){var t=pwebcontact_l10n.form.SEND_ERR;return"popup"==this.options.msgPosition?this.displayAlert(t,"error"):(this.scrollToMsg(),this.displayMsg(t,"error")),!1}this.status=1,this.scrollToMsg(),this.options.reloadToken&&this.ajaxCall("getToken",!1),1==this.status&&this.ajaxCall("sendEmail")},ajaxCall:function(s,i){var o=this,e={mid:this.options.id,format:"json",ignoreMessages:!0};("sendEmail"==s||"checkCaptcha"==s)&&(e=decodeURIComponent(t.param(e))+"&"+this.Form.serialize()),"undefined"==typeof i&&(i=!0),t.ajax({url:this.options.ajaxUrl+s,type:"POST",cache:!1,async:i,data:e,dataType:"json",dataFilter:this.ajaxResponseDataFilter,beforeSend:function(){"sendEmail"!=s&&i||o.displayMsg(pwebcontact_l10n.form.SENDING,"progress")}}).done(function(e,n,l){if("undefined"!=typeof e.data&&"undefined"!=typeof e.data.status){var a=e.data;i||o.displayMsg("",""),"getToken"==s?(o.options.reloadToken=!1,o.Token.attr("name",a.token)):(a.debug&&o.debug(a.debug,a.status),a.status>=1&&a.status<=199?"sendEmail"==s&&(o.status=3,1==o.options.reset&&o.resetForm(),o.displayMsg(a.msg,"success")):("undefined"!=typeof a.invalid&&(o.Form.find(".invalid").removeClass("invalid"),t.each(a.invalid,function(s,i){var e=t(o.options.selector+"_"+i);e.is("input,textarea,select")&&e.addClass("invalid"),t(o.options.selector+"_"+i+"-lbl").addClass("invalid")})),o.status=0,a.status>=300&&!o.options.debug&&(o.status=5,o.ButtonSend.hide()),o.displayMsg(a.msg,"error")))}else o.displayError(n,-1===l.responseText.indexOf("<html")?l.responseText:"")}).fail(function(t,s,i){o.displayError(t.status+" "+i,-1===t.responseText.indexOf("<html")?t.responseText:"")})},ajaxResponseDataFilter:function(s,i){if("iframe json"===i&&s&&"object"==typeof s&&(s=t(s[0].body).text()),-1!==i.indexOf("json")&&"string"==typeof s&&(0!==s.indexOf("{")||"}"!==s[s.length-1])){var o=s.match(/{"success":.+{"status":[0-9]+(,"[a-z]+":.+)+}}/i);if(o)if("function"==typeof JSON.stringify){var e=t.parseJSON(o[0]);"undefined"!=typeof e.data.debug&&e.data.debug||(e.data.debug=[]),e.data.debug.push(s.replace(o[0]," ")),s=JSON.stringify(e)}else s=o[0]}return s},scrollToMsg:function(){if("before"==this.options.msgPosition||"after"==this.options.msgPosition)if("modal"==this.options.layout){var s="after"==this.options.msgPosition?this.Box.outerHeight()-t(window).height():0;s>=0&&this.Modal.animate({scrollTop:s},500)}else if("fixed"!=this.element.css("position")){var s=this.Msg.offset().top-20;"after"==this.options.msgPosition&&(s=s+60+this.Msg.height()-t(window).height()),t("html,body").animate({scrollTop:parseInt(s)},500)}},displayError:function(t,s){this.options.debug?this.status=0:(this.status=5,this.ButtonSend.hide());var i=pwebcontact_l10n.form.REQUEST_ERR+t;"popup"==this.options.msgPosition?this.displayAlert(i,"error"):this.displayMsg(i,"error"),s&&this.debug(s)},displayMsg:function(t,s){this.Msg.html(t?t:"&nbsp;").attr("class",s?"pweb-"+s:"")},displayAlert:function(s,i,o,e){if("function"==typeof t.fn.alert){var n=t('<div class="pweb-alert alert alert-block '+(i?"alert-"+i:"")+' fade in"><button data-dismiss="alert" class="close" type="button">&times;</button>'+("undefined"!=typeof o?'<h4 class="alert-heading">'+o+"</h4>":"")+"<p>"+s+"</p></div>").alert().appendTo(document.body);("undefined"==typeof e||e)&&this.options.msgCloseDelay&&setTimeout(function(){n.alert("close")},1e3*this.options.msgCloseDelay)}else n(s.replace("<br>","\r\n"))},debug:function(s,i){t.isArray(s)&&(s=s.join("<br>")),"undefined"!=typeof i&&(s=s+"<br>Response code: "+i),this.displayAlert(s,"info","Perfect Easy & Powerful Contact Form Debug",!1)}}}(),pwebContact.options=pwebContact.prototype.options}(window.jQuery);